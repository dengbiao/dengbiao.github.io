<!DOCTYPE html>
<html>

    <head>
        <meta charset=utf-8 />
        <title>
             邓彪的博客   
             | Vagrant 入门 
        </title>
        <link rel="shortcut icon" type="image/ico" href="/assets/images/portrait.jpg">
        <link rel="stylesheet" href="/assets/css/clear.css" />
        
        <link rel="stylesheet" href="/assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="/assets/css/default.css" />
        <link rel="stylesheet" href="/assets/css/pygments.css" />
        <script src="/assets/js/jquery-1.10.2.min.js"></script>

    </head>

    <body>
        <div id="container main">
            <header>
            <div class="info">
                <div class="logo">
                    <a href="/pages/about.html"><img class="portrait img-circle" src="/assets/images/portrait.jpg" /></a>
                </div>
                <h1><a href="/">邓彪的博客</a></h1>
                <div class="motto">有一种东西叫做梦想</div>
            </div>
            <form method="get" action="http://www.google.com.hk/search" id="search-form">
                <div class="input-group input-group-sm header_search">
                    <input type="text" id="search-query" name="q" id="s" autocomplete="on" class="form-control" placeholder="Search">
                    <span class="input-group-addon text" >
                        <input type="submit" name="btnG" value="搜索" id="search-btn">
                    </span>
                    <input type="hidden" name="ie" value="UTF-8">
                    <input type="hidden" name="oe" value="UTF-8">
                    <input type="hidden" name="hl" value="zh-CN">
                    <input type="hidden" name="domains" value="dengbiao.github.io">
                    <input type="hidden" name="sitesearch" value="dengbiao.github.io">
                </div>
            </form>

            <ul class="sidelist">
                <li><a href="http://127.0.0.4/atom.xml" class="rss" title="订阅"></a></li>
                <li><a href="http://127.0.0.4/pages/archive.html" class="archive" title="归档"></a></li>
            </ul>
            </header>

            <article>
            <div class="page_container">
    <div class="date">
        <span class="day">
            21
        </span>
        <span class="month">
            02
        </span>
    </div>
    <div class="page_item">
        
        <div class="title">
            <h1><a href="/accumulation/python/2013/02/21/vagrant-e585a5e997a8.html">Vagrant 入门</a></h1>
        </div>
        
        
        <div class="page_content">
            <p>
<p>转自：<a href="http://blog.csdn.net/jillliang/article/details/8251242">http://blog.csdn.net/jillliang/article/details/8251242</a></p>

<h3 id="1_vagrant">1. Vagrant功能:</h3>

<p>Vagrant uses <a href="http://www.virtualbox.org/">Oracle's VirtualBox</a> to build configurable, lightweight, and portable virtual machines dynamically..</p>

<p>【Vagrant 使用Oracle VM VirtualBox 动态创建和配置轻量级的，可重现的，便携的虚拟机环境。】</p>

<h3 id="2_vagrant">2. Vagrant下载:</h3>

<p><a href="http://downloads.vagrantup.com/tags/v1.0.5">http://downloads.vagrantup.com/tags/v1.0.5</a></p>
<!--more-->
<h3 id="3_vagrant">3. Vagrant安装:</h3>

<h4 id="31_oracle_vm_virtualbox_windowsvirtualbox42080737winexe">3.1. 下载并安装Oracle VM VirtualBox: 例如在Windows环境下，需要安装VirtualBox-4.2.0-80737-Win.exe</h4>

<p><a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></p>

<h4 id="32_vagrant">3.2. 下载并安装最新版本的Vagrant:</h4>

<p><a href="http://downloads.vagrantup.com/">http://downloads.vagrantup.com/</a></p>

<p>[注]在 Windows and Mac OS X,<code>vagrant</code> 命令应该自动添加到环境变量<code>PATH</code>. 但是在其他操作系统下, 你必须手动添加<code>/opt/vagrant/bin</code> 到环境变量<code>PATH。</code></p>

<h3 id="4_vagrant">4. Vagrant命令</h3>

<p>Vagrant安装完成之后，我们就可以从命令行通过vagrant命令来进行操作。vagrant 常用命令如下：</p>

<pre><code>vagrant box add &lt;name&gt; &lt;url&gt;  
vagrant box list  
vagrant box remove &lt;name&gt;  
vagrant box repackage &lt;name&gt;   
vagrant init [box-name] [box-url]  
vagrant up [vm-name] [--[no-]provision] [-h]  
vagrant destroy [vm-name]  
vagrant suspend [vm-name]  
vagrant reload [vm-name]  
vagrant resume [vm-name]  
vagrant halt [vm-name]  
vagrant status [vm-name]   
vagrant package [vm-name] [--base name] [--output name.box][--include one,two,three] [--vagrantfile file]  
vagrant provision [vm-name]  
vagrant ssh [vm-name] [-c command] [-- extra ssh args]  
vagrant ssh-config [vm-name] [--host name]</code></pre>

<h3 id="5_vagrantfile">5. Vagrantfile</h3>

<p>任何Vagrant工程下都有一个Vagrantfile, 就像makefile一样，Vagrantfile用来配置vagrant的行为所创建虚拟机的信息，下面是一个基本的Vagrantfile:</p>

<pre><code>Vagrant::Config.run do |config|
    \#Setup the box
    config.vm.box = &quot;my_box&quot;
end</code></pre>

<h3 id="6_vagrant">6. 创建第一个Vagrant虚拟环境以及工程:</h3>

<p>(1)创建工程目录， 并且执行vagrant init命令，该命令会产生最初的 Vagrantfile</p>

<pre><code>$ mkdir vagrant_guide
$ cd vagrant_guide
$ vagrant init</code></pre>

<p><img alt="" src="http://img.my.csdn.net/uploads/201212/03/1354515824_8087.PNG" /></p>

<p>(2)添加一个Base Box:</p>

<p>Vagrant不是从头开始创建虚拟机，而是导入一个虚机的base image，在这个基础上进行构建。这些image就叫做Box.</p>

<p>Vagrant 支持从本地文件系统或者HTTP URL来添加boxes</p>

<pre><code>$vagrant box add base http://files.vagrantup.com/lucid32.box
$vagrant box add base D:\lucid32.box</code></pre>

<p><img alt="" src="http://img.my.csdn.net/uploads/201212/03/1354516669_4279.PNG" /></p>

<p>(3)配置Project使用这个Box: 修改Vagrantfile为如下内容：</p>

<pre><code>Vagrant::Config.run do |config|  
    config.vm.box = &quot;base&quot;  
end</code></pre>

<p>(4)启动虚拟机</p>

<pre><code>$vagrant up  </code></pre>

<p><img alt="" src="http://img.my.csdn.net/uploads/201212/03/1354517333_8671.PNG" /></p>

<p>(5)停掉虚拟机</p>

<pre><code>$vagrant destroy  </code></pre>

<p>(6) SSH配置</p>

<p>Vagrant 提供了对虚拟机的SSH连接，只需要执行一个命令：</p>

<pre><code>$vagrant ssh  </code></pre>

<p>在Windows环境下可以使用PUTTY，配置下面的信息来连接虚拟机：</p>

<pre><code>hostname: localhost
port: 2222
Connection Type: SSH
User Name: vagrant
Password: vagrant</code></pre>

<p><img alt="" src="http://img.my.csdn.net/uploads/201212/03/1354517823_4070.PNG" /></p>

<p>(7)访问刚才创建的Project.</p>

<p>Vagrant 通过VirtualBox的shared folder来连接你的application和虚拟机， 默认的shared folder的卫士是/vagrant， 所以想要查看刚才创建的项目，只需要执行：</p>

<pre><code>vagrant@lucid32:~$ ls /vagrant  </code></pre>

<p>(8) Provisioning：</p>

<p>通常情况下Box只做最基本的设置，而不是一次到位的设置好所有的环境。Vagrant通常使用<a href="http://www.opscode.com/chef">chef</a>或者<a href="http://www.puppetlabs.com/puppet">Puppet</a>来做进一步的环境搭建。</p>

<p>回到刚才创建的index.html，我们需要安装Apache。我们下面用Puppet来完成这一设置。</p>

<ol>
<li>在项目的根目录下创建文件夹manifests，然后在该文件家中创建Puppet的配置文件default.pp，该文件内容如下：</li>
</ol>
<div class='highlight'><pre><code class='python'><span class='c'># Basic Puppet Apache manifest</span>

<span class='k'>class</span> <span class='nc'>apache</span> <span class='p'>{</span>
    <span class='k'>exec</span> <span class='p'>{</span> <span class='s'>&#39;apt-get update&#39;</span><span class='p'>:</span>
        <span class='n'>command</span> <span class='o'>=&gt;</span> <span class='s'>&#39;/usr/bin/apt-get update&#39;</span>
    <span class='p'>}</span>

    <span class='n'>package</span> <span class='p'>{</span> <span class='s'>&quot;apache2&quot;</span><span class='p'>:</span>
        <span class='n'>ensure</span> <span class='o'>=&gt;</span> <span class='n'>present</span><span class='p'>,</span>
    <span class='p'>}</span>

    <span class='n'>service</span> <span class='p'>{</span> <span class='s'>&quot;apache2&quot;</span><span class='p'>:</span>
        <span class='n'>ensure</span> <span class='o'>=&gt;</span> <span class='n'>running</span><span class='p'>,</span>
               <span class='n'>require</span> <span class='o'>=&gt;</span> <span class='n'>Package</span><span class='p'>[</span><span class='s'>&quot;apache2&quot;</span><span class='p'>],</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
<ol>
<li>在Vagrantfile里添加对Puppet provisioning的支持：</li>
</ol>
<div class='highlight'><pre><code class='console'><span class='go'>    Vagrant::Config.run do |config|  </span>
<span class='go'>        config.vm.box = &quot;base&quot;  </span>
<span class='go'>        \# Enable the Puppet provisioner  </span>
<span class='go'>        config.vm.provision :puppet  </span>
<span class='go'>    end</span>
</code></pre></div>
<p>(9) 运行Project</p>

<p>为了使puppet的配置生效，如果不重启虚机，则需要执行<code>vagrant reload</code>命令。</p>

<pre><code>$ vagrant reload </code></pre>

<p>因为没有配置port forwarding，所以你还不能从本地浏览器查看Project的输出。只能SSH到虚拟机上查看127.0.0.1的输出：</p>

<p><img alt="" src="http://img.my.csdn.net/uploads/201212/03/1354519989_4712.PNG" /></p>

<p>(10) 进行端口映射</p>

<p>修改Vagrantfile， 添加本地端口和虚机端口的映射关系， 然后执行vagrant reload, 然后你就可以通过本地浏览器来访问：<a href="http://localhost:4567/">http://localhost:4567</a>.</p>
<div class='highlight'><pre><code class='console'><span class='go'>    Vagrant::Config.run do |config|</span>
<span class='go'>        \# Forward guest port 80 to host port 4567</span>
<span class='go'>        config.vm.forward_port 80, 4567</span>
<span class='go'>    end </span>
</code></pre></div>
<p><img alt="" src="http://img.my.csdn.net/uploads/201212/03/1354520417_4109.PNG" /></p>

<h3 id="7__packaging">7. 打包 Packaging</h3>

<ol>
<li>
<p>创建一个新的文件Vagrantfile.pkg，内容如下：</p>

<p>Vagrant::Config.run do |config| # Forward apache config.vm.forward_port 80, 8080<br /> end</p>
</li>

<li>
<p>打包Project</p>

<p>$ vagrant package –vagrantfile Vagrantfile.pkg</p>
</li>
</ol>

<h3 id="8_packageboxbox">8. 打包完成后，在工程根目录下就会生成package.box，别人就可以使用这个Box了：</h3>

<pre><code>$ vagrant box add my_box /path/to/the/package.box  
$ vagrant init my_box  
$ vagrant up</code></pre>
</p> 
        </div>


        <div class="page_comments" id="page_comments">
            <!-- Duoshuo Comment BEGIN -->
            <div class="ds-thread" data-thread-key="/accumulation/python/2013/02/21/vagrant-e585a5e997a8" data-title="Vagrant 入门" ></div>
            <script type="text/javascript">
                var duoshuoQuery = {short_name:"dengbiao"};
(function() {
 var ds = document.createElement('script');
 ds.type = 'text/javascript';ds.async = true;
 ds.src = 'http://static.duoshuo.com/embed.js';
 ds.charset = 'UTF-8';
 (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
 })();
</script>
<!-- Duoshuo Comment END -->
    </div>
    </div>
</div>
<div class="clear"></div>


            </article>

            <footer>
            <p>
            Copyright @ 2013-2015 dengbiao | All Rights Reserved. Powered by <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="http://getbootstrap.com/" target="_blank" >Bootstrap</a>. 
            </p>
            </footer>

        </div>

        <! --- backToTop js  -->
        <script>
            (function() {
                var $backToTopTxt = "", $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body"))
                .text($backToTopTxt).attr("title", $backToTopTxt).click(function() {
                    $("html, body").animate({ scrollTop: 0 }, 120);
                    }), $backToTopFun = function() {
                    var st = $(document).scrollTop(), winh = $(window).height();
                    (st > 0)? $backToTopEle.fadeIn('slow') : $backToTopEle.fadeOut('slow');
                    //IE6下的定位
                    if (!window.XMLHttpRequest) {
                        $backToTopEle.css("top", st + winh - 166);
                    }
                };
                $(window).bind("scroll", $backToTopFun);
                $(function() { $backToTopFun(); });
            })();
        </script>

        <! --- google analytics  -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-45239189-1', 'dengbiao.github.io');
            ga('send', 'pageview');

        </script>

    </body>

</html>
